{% extends 'RainyDaysHero/base-second.html' %}

{% block additionnal-head-conf %}
	{% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'RainyDaysHero/css/styleQuotationForm.css' %}">
    <script type="text/javascript" src="{% static 'RainyDaysHero/js/chart-min.js' %}"></script>
{% endblock %}

{% block content %}

	<div class="container my-2 block-content" style={visibility='hidden'}>
	  <div class="row">
	    <div class="col-md-6 mx-auto myform">
	    <h3 class="formtitle">Term Insurance Stresstest</h3>

		<form action="/rdh/terminsurance-stress/" method="post" onsubmit="return checkForm(this);" >
			{% csrf_token %}

		<div class="form-group">
	        {{ form.contractOrTotal }}
	        <label class="form-control-placeholder" for="{{ form.contractOrTotal.id_for_label }}">{{form.contractOrTotal.label}}</label>
	     </div>

		<!--<div id="contract" style="display: none;">-->
		<div id="contract">

			<div class="form-group">
		        {{ form.stressOn }}
		        <label class="form-control-placeholder" for="{{ form.stressOn.id_for_label }}">{{form.stressOn.label}}</label>
		     </div>

			<div class="form-group">
		        {{ form.stressType }}
		        <label class="form-control-placeholder" for="{{ form.stressType.id_for_label }}">{{form.stressType.label}}</label>
		     </div>

			  <div class="form-group">
		        {{ form.clientAge}}
		        <label class="form-control-placeholder" for="{{ form.clientAge.id_for_label }}">Age</label>
		      </div>

		      <div class="form-group">
		        {{ form.numberOfPayements}}
		        <label class="form-control-placeholder" for="{{ form.numberOfPayements.id_for_label }}">Number of payements</label>
		      </div>

		      <div class="form-group">
		        {{ form.maturity }}
		        <label class="form-control-placeholder" for="{{ form.maturity.id_for_label }}">Maturity</label>
		      </div>

		      <div class="form-group">
		        {{ form.interestRate }}
		        <label class="form-control-placeholder" for="{{ form.interestRate.id_for_label }}">{{ form.interestRate.label }}</label>
		      </div>

		      <div class="form-group">
		        {{ form.amount }}
		        <label class="form-control-placeholder" for="{{ form.amount.id_for_label }}">{{ form.amount.label }}</label>
		      </div>

		      <div class="form-group">
		        <button type="submit" class="btn btn-dark">Compute</button>
		      </div>
			
		</div>

		</form>

	    </div> <!--My form-->

	    <!--Stress contract result-->
	    <div id="stressContractResult" class="col-md-6 mx-auto myform"> 
	    	 <h3 class="formtitle">Stresstest Contract result</h3>
		     <div class="form-group">
		            <div class="card">
		                <div class="card-body">
		                    <canvas id="reserveChart"></canvas>
		                </div>
		            </div>
	         </div>

	    </div> 
	    <!--Stress contract result-->

	    <!--Stress Total result-->
	    <div id="stressTotalResult" class="col-md-12 mx-auto myform"> 
	    	 <h3 class="formtitle">Stress Total result</h3>
		     <div class="form-group">
		            RESULT TOTAL
	         </div>
	    </div>
	    <!--Stress Total result-->

	  </div> <!--Row-->

	</div> <!--Container-->


<script type="text/javascript">
//stress type form switch
function stressTypeSwitch(){
	if(document.getElementById("{{ form.contractOrTotal.id_for_label }}").value=='Contract'){
		document.getElementById("stressTotalResult").style.display="none";
		document.getElementById("contract").style.display="block";
	}
	if(document.getElementById("{{ form.contractOrTotal.id_for_label }}").value=='Total'){
		document.getElementById("stressTotalResult").style.display="block";
		document.getElementById("contract").style.display="none";
		document.getElementById("stressContractResult").style.display="none";
	}
}
//stress type form switch end
function checkRequestType(){
if('{{requestType}}'=='GET'){
	document.getElementById("stressTotalResult").style.display="none";
	document.getElementById("stressContractResult").style.display="none";
}else{
	document.getElementById("stressTotalResult").style.display="none";
	document.getElementById("stressContractResult").style.display="block";
	var ctxL = document.getElementById("reserveChart").getContext('2d');
	var aLocal = {{ a|safe }};
	var bLocal = {{ b|safe }};
	var cLocal = {{ c|safe }};
	var dLocal = {{ d|safe }};

	if('{{plotNumber}}'=='1'){
		//chart begin
		var myLineChart = new Chart(ctxL, {
		type: 'line',
		data: {
			labels: aLocal,
			datasets: [{
				label: '{{labelOne}}',
				data:  bLocal,
				backgroundColor: [
				'rgba(105, 0, 132, .2)',
				],
				borderColor: [
				'rgba(200, 99, 132, .7)',
				],
				borderWidth: 2
			}
			]
		},
		options: {
		responsive: true
		}
		});
		//chart end

	}else{
		//chart begin
		var myLineChart = new Chart(ctxL, {
		type: 'line',
		data: {
			labels: aLocal,
			datasets: [{
				label: '{{labelOne}}',
				data:  bLocal,
				backgroundColor: [
				'rgba(105, 0, 132, .2)',
				],
				borderColor: [
				'rgba(200, 99, 132, .7)',
				],
				borderWidth: 2
			},
			{
				label: '{{labelTwo}}',
				data:  cLocal,
				backgroundColor: [
				'rgba(0, 137, 132, .2)',
				],
				borderColor: [
				'rgba(0, 10, 130, .7)',
				],
				borderWidth: 2
			},
			{
				label: '{{labelThree}}',
				data:  dLocal,
				backgroundColor: [
				'rgba(0, 17, 172, .2)',
				],
				borderColor: [
				'rgba(0, 10, 130, .7)',
				],
				borderWidth: 2
			}
			]
		},
		options: {
		responsive: true
		}
		});
		//chart end
	}


 }
 stressTypeSwitch();
}

window.onload = checkRequestType

  function checkForm(form)
  {
  	if(document.getElementById("{{ form.contractOrTotal.id_for_label }}").value=='Contract'){
	    //POSITIVITY
	    //i > 0
	    if(form.interestRate.value < 0) {
	      alert("The interest rate must be positive !");
	      form.interest.focus();
	      return false;
	    }

	    //amount > 0
	    if(form.amount.value <= 0) {
	      alert("The amount must be strictly positive !");
	      form.amount.focus();
	      return false;
	    }

	    // client age 
	    if(form.clientAge.value < 0) {
	      alert("The client age must be positive!");
	      form.clientAge.focus();
	      return false;
	    }
	    // n
	    if(form.maturity.value <= 0) {
	      alert("The maturity (n) must be strictly positive !");
	      form.maturity.focus();
	      return false;
	    }
	    // m
	    if(form.numberOfPayements.value <= 0) {
	      alert("The number of payement (m) must be strictly positive !");
	      form.numberOfPayements.focus();
	      return false;
	    }

	    //SPECIAL CONDITIONS
	    // client age 
	    if(form.clientAge.value > 100) {
	      alert("The client age must be less than 100 !");
	      form.clientAge.focus();
	      return false;
	    }

	    // n >=m
	    if(form.maturity.value < form.numberOfPayements.value) {
	      alert("The number of payement (m) must be less or equal to the maturity !");
	      form.numberOfPayements.focus();
	      return false;
	    }
	}

    // validation was successful
    return true;
  }

</script> 
{% endblock %}